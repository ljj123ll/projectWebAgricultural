# 数据库设计
### 一、需求理解
你需要为这个面向农村用户的助农电商平台（包含用户端、商家端、管理员端）设计一套完整、规范且具备扩展性的数据库结构，要求覆盖所有核心业务链路（商品交易、溯源、订单、售后、审核、对账、补贴等），同时适配后续分阶段优化（如Redis扩展、分库分表、区块链溯源等）的需求。

### 二、数据库设计方案
#### 设计原则
1. 遵循**第三范式**，减少数据冗余，核心表预留扩展字段；
2. 字段类型精准（如金额用`decimal(10,2)`、手机号用`varchar(11)`），状态字段用`tinyint`（便于索引和枚举管理）；
3. 所有业务表添加`delete_flag`软删除字段、`create_time/update_time`时间字段，便于数据追溯；
4. 关键查询字段（如订单状态、用户ID、商家ID）添加索引，适配高频查询场景；
5. 预留分布式扩展能力（主键用`bigint`，支持雪花算法；表结构适配ShardingSphere分库分表）。

#### 核心表结构设计（MySQL）
##### 1. 系统基础模块（管理员端核心）
```sql
-- 管理员用户表
CREATE TABLE sys_user (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '管理员ID',
    username VARCHAR(50) NOT NULL COMMENT '登录账号',
    password VARCHAR(100) NOT NULL COMMENT '加密密码（BCrypt）',
    phone VARCHAR(11) NOT NULL COMMENT '手机号',
    real_name VARCHAR(20) COMMENT '真实姓名',
    role_id BIGINT NOT NULL COMMENT '角色ID',
    status TINYINT DEFAULT 1 COMMENT '状态 0-禁用 1-正常',
    last_login_time DATETIME COMMENT '最后登录时间',
    delete_flag TINYINT DEFAULT 0 COMMENT '软删除 0-未删 1-已删',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    INDEX idx_role_id (role_id),
    INDEX idx_phone (phone)
) COMMENT = '管理员用户表';

-- 角色表
CREATE TABLE sys_role (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '角色ID',
    role_name VARCHAR(30) NOT NULL COMMENT '角色名称（超级管理员/内容管理员）',
    role_code VARCHAR(30) NOT NULL COMMENT '角色编码（SUPER_ADMIN/CONTENT_ADMIN）',
    description VARCHAR(200) COMMENT '角色描述',
    delete_flag TINYINT DEFAULT 0 COMMENT '软删除 0-未删 1-已删',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    UNIQUE KEY uk_role_code (role_code)
) COMMENT = '角色表';

-- 权限表
CREATE TABLE sys_permission (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '权限ID',
    perm_name VARCHAR(50) NOT NULL COMMENT '权限名称',
    perm_code VARCHAR(50) NOT NULL COMMENT '权限编码（如merchant:audit、order:manage）',
    parent_id BIGINT DEFAULT 0 COMMENT '父权限ID',
    delete_flag TINYINT DEFAULT 0 COMMENT '软删除 0-未删 1-已删',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    UNIQUE KEY uk_perm_code (perm_code)
) COMMENT = '权限表';

-- 角色权限关联表
CREATE TABLE sys_role_permission (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '关联ID',
    role_id BIGINT NOT NULL COMMENT '角色ID',
    perm_id BIGINT NOT NULL COMMENT '权限ID',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    UNIQUE KEY uk_role_perm (role_id, perm_id),
    INDEX idx_role_id (role_id),
    INDEX idx_perm_id (perm_id)
) COMMENT = '角色权限关联表';

-- 系统操作日志表
CREATE TABLE sys_operation_log (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '日志ID',
    operator_id BIGINT NOT NULL COMMENT '操作人ID（管理员ID）',
    operator_name VARCHAR(50) NOT NULL COMMENT '操作人名称',
    operation_type VARCHAR(20) NOT NULL COMMENT '操作类型（新增/编辑/删除/审核）',
    business_type VARCHAR(50) NOT NULL COMMENT '业务类型（商家审核/商品审核/订单管控）',
    business_id BIGINT NOT NULL COMMENT '业务ID（如商家ID/商品ID）',
    operation_content TEXT COMMENT '操作内容（JSON格式）',
    ip VARCHAR(32) COMMENT '操作IP',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '操作时间',
    INDEX idx_operator_id (operator_id),
    INDEX idx_business_type_id (business_type, business_id),
    INDEX idx_create_time (create_time)
) COMMENT = '系统操作日志表';
```

##### 2. 用户端核心模块
```sql
-- 消费者用户表
CREATE TABLE user_info (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '用户ID',
    phone VARCHAR(11) NOT NULL COMMENT '手机号（唯一）',
    nickname VARCHAR(50) COMMENT '昵称（默认脱敏手机号）',
    password VARCHAR(100) COMMENT '密码（可选，免密登录可不填）',
    avatar_url VARCHAR(255) COMMENT '头像URL',
    last_login_time DATETIME COMMENT '最后登录时间',
    login_token VARCHAR(100) COMMENT 'Redis登录态token',
    token_expire_time DATETIME COMMENT 'token过期时间（7天）',
    status TINYINT DEFAULT 1 COMMENT '状态 0-禁用 1-正常',
    delete_flag TINYINT DEFAULT 0 COMMENT '软删除 0-未删 1-已删',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    UNIQUE KEY uk_phone (phone),
    INDEX idx_login_token (login_token)
) COMMENT = '消费者用户表';

-- 用户收货地址表
CREATE TABLE user_address (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '地址ID',
    user_id BIGINT NOT NULL COMMENT '用户ID',
    receiver VARCHAR(20) NOT NULL COMMENT '收件人',
    phone VARCHAR(11) NOT NULL COMMENT '收件手机号',
    province VARCHAR(20) NOT NULL COMMENT '省',
    city VARCHAR(20) NOT NULL COMMENT '市',
    county VARCHAR(20) NOT NULL COMMENT '县/区',
    town VARCHAR(20) NOT NULL COMMENT '乡镇/街道',
    detail_address VARCHAR(200) NOT NULL COMMENT '详细地址',
    is_default TINYINT DEFAULT 0 COMMENT '是否默认 0-否 1-是',
    delete_flag TINYINT DEFAULT 0 COMMENT '软删除 0-未删 1-已删',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    INDEX idx_user_id (user_id),
    INDEX idx_user_default (user_id, is_default)
) COMMENT = '用户收货地址表';

-- 购物车表
CREATE TABLE cart (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '购物车ID',
    user_id BIGINT NOT NULL COMMENT '用户ID',
    product_id BIGINT NOT NULL COMMENT '商品ID',
    product_num INT NOT NULL COMMENT '商品数量',
    select_status TINYINT DEFAULT 1 COMMENT '是否选中 0-否 1-是',
    delete_flag TINYINT DEFAULT 0 COMMENT '软删除 0-未删 1-已删',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    UNIQUE KEY uk_user_product (user_id, product_id),
    INDEX idx_user_id (user_id)
) COMMENT = '购物车表';

-- 订单主表
CREATE TABLE order_main (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '订单ID',
    order_no VARCHAR(32) NOT NULL COMMENT '订单编号（唯一，雪花算法生成）',
    user_id BIGINT NOT NULL COMMENT '用户ID',
    address_id BIGINT NOT NULL COMMENT '收货地址ID',
    total_amount DECIMAL(10,2) NOT NULL COMMENT '订单总金额',
    order_status TINYINT NOT NULL COMMENT '订单状态 1-待付款 2-待发货 3-待收货 4-已完成 5-已取消 6-支付异常',
    cancel_reason VARCHAR(100) COMMENT '取消原因（超时未付款/用户手动取消/商家取消）',
    pay_deadline DATETIME COMMENT '支付截止时间（创建后15分钟）',
    receiver VARCHAR(20) NOT NULL COMMENT '收件人',
    receiver_phone VARCHAR(11) NOT NULL COMMENT '收件手机号',
    receiver_address VARCHAR(255) NOT NULL COMMENT '收件地址（省市区乡镇+详细）',
    merchant_id BIGINT NOT NULL COMMENT '商家ID',
    delete_flag TINYINT DEFAULT 0 COMMENT '软删除 0-未删 1-已删',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    UNIQUE KEY uk_order_no (order_no),
    INDEX idx_user_id (user_id),
    INDEX idx_merchant_id (merchant_id),
    INDEX idx_order_status (order_status),
    INDEX idx_create_time (create_time)
) COMMENT = '订单主表（适配分表：按create_time分表）';

-- 订单详情表
CREATE TABLE order_item (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '订单详情ID',
    order_no VARCHAR(32) NOT NULL COMMENT '订单编号',
    product_id BIGINT NOT NULL COMMENT '商品ID',
    product_name VARCHAR(100) NOT NULL COMMENT '商品名称',
    product_img VARCHAR(255) COMMENT '商品图片',
    product_price DECIMAL(10,2) NOT NULL COMMENT '商品单价',
    product_num INT NOT NULL COMMENT '购买数量',
    product_amount DECIMAL(10,2) NOT NULL COMMENT '商品小计金额',
    delete_flag TINYINT DEFAULT 0 COMMENT '软删除 0-未删 1-已删',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    INDEX idx_order_no (order_no),
    INDEX idx_product_id (product_id)
) COMMENT = '订单详情表';

-- 支付记录表
CREATE TABLE payment_record (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '支付记录ID',
    order_no VARCHAR(32) NOT NULL COMMENT '订单编号',
    pay_type TINYINT COMMENT '支付方式 1-支付宝 2-微信支付',
    pay_amount DECIMAL(10,2) NOT NULL COMMENT '支付金额',
    pay_status TINYINT NOT NULL COMMENT '支付状态 0-待支付 1-支付成功 2-支付失败 3-支付异常',
    pay_time DATETIME COMMENT '支付时间',
    transaction_id VARCHAR(64) COMMENT '第三方支付流水号',
    refund_status TINYINT DEFAULT 0 COMMENT '退款状态 0-未退款 1-退款中 2-退款成功 3-退款失败',
    refund_amount DECIMAL(10,2) DEFAULT 0 COMMENT '退款金额',
    refund_time DATETIME COMMENT '退款时间',
    delete_flag TINYINT DEFAULT 0 COMMENT '软删除 0-未删 1-已删',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    INDEX idx_order_no (order_no),
    INDEX idx_pay_status (pay_status)
) COMMENT = '支付记录表（打款台账核心表）';

-- 物流信息表
CREATE TABLE logistics_info (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '物流ID',
    order_no VARCHAR(32) NOT NULL COMMENT '订单编号',
    logistics_company VARCHAR(50) COMMENT '快递公司',
    logistics_no VARCHAR(50) COMMENT '物流单号',
    logistics_status TINYINT DEFAULT 0 COMMENT '物流状态 0-未发货 1-已发货 2-运输中 3-已签收 4-异常',
    abnormal_reason VARCHAR(100) COMMENT '物流异常原因',
    delete_flag TINYINT DEFAULT 0 COMMENT '软删除 0-未删 1-已删',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    UNIQUE KEY uk_order_no (order_no),
    INDEX idx_logistics_no (logistics_no)
) COMMENT = '物流信息表';

-- 评价表
CREATE TABLE comment (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '评价ID',
    order_no VARCHAR(32) NOT NULL COMMENT '订单编号',
    product_id BIGINT NOT NULL COMMENT '商品ID',
    user_id BIGINT NOT NULL COMMENT '用户ID',
    score TINYINT NOT NULL COMMENT '评分（1-5分）',
    content TEXT COMMENT '评价内容',
    img_urls VARCHAR(500) COMMENT '评价图片/视频URL（逗号分隔）',
    audit_status TINYINT DEFAULT 1 COMMENT '审核状态 0-待审核 1-已通过 2-已驳回',
    delete_flag TINYINT DEFAULT 0 COMMENT '软删除 0-未删 1-已删',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    INDEX idx_product_id (product_id),
    INDEX idx_user_id (user_id),
    INDEX idx_order_no (order_no),
    INDEX idx_audit_status (audit_status)
) COMMENT = '商品评价表';

-- 售后表
CREATE TABLE after_sale (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '售后ID',
    after_sale_no VARCHAR(32) NOT NULL COMMENT '售后单号（唯一）',
    order_no VARCHAR(32) NOT NULL COMMENT '订单编号',
    user_id BIGINT NOT NULL COMMENT '用户ID',
    merchant_id BIGINT NOT NULL COMMENT '商家ID',
    after_sale_type TINYINT NOT NULL COMMENT '售后类型 1-退款 2-退货 3-换货',
    apply_reason VARCHAR(50) NOT NULL COMMENT '申请原因（变质/少发/规格不符等）',
    proof_img_urls VARCHAR(500) COMMENT '凭证图片URL（逗号分隔）',
    after_sale_status TINYINT NOT NULL COMMENT '售后状态 1-待商家处理 2-协商中 3-已解决 4-管理员介入 5-已驳回',
    handle_result VARCHAR(200) COMMENT '处理结果',
    admin_id BIGINT COMMENT '介入管理员ID',
    delete_flag TINYINT DEFAULT 0 COMMENT '软删除 0-未删 1-已删',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    UNIQUE KEY uk_after_sale_no (after_sale_no),
    INDEX idx_order_no (order_no),
    INDEX idx_merchant_id (merchant_id),
    INDEX idx_after_sale_status (after_sale_status)
) COMMENT = '售后表';

-- 售后沟通表
CREATE TABLE after_sale_communication (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '沟通ID',
    after_sale_no VARCHAR(32) NOT NULL COMMENT '售后单号',
    sender_type TINYINT NOT NULL COMMENT '发送方类型 1-用户 2-商家 3-管理员',
    sender_id BIGINT NOT NULL COMMENT '发送方ID',
    content TEXT NOT NULL COMMENT '沟通内容',
    is_read TINYINT DEFAULT 0 COMMENT '是否已读 0-未读 1-已读',
    delete_flag TINYINT DEFAULT 0 COMMENT '软删除 0-未删 1-已删',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    INDEX idx_after_sale_no (after_sale_no),
    INDEX idx_sender_id (sender_id)
) COMMENT = '售后沟通表';

-- 新闻分类表
CREATE TABLE news_category (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '分类ID',
    category_name VARCHAR(30) NOT NULL COMMENT '分类名称（农业政策/扶贫案例/产地动态）',
    category_code VARCHAR(30) NOT NULL COMMENT '分类编码',
    delete_flag TINYINT DEFAULT 0 COMMENT '软删除 0-未删 1-已删',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    UNIQUE KEY uk_category_code (category_code)
) COMMENT = '助农新闻分类表';

-- 助农新闻表
CREATE TABLE news (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '新闻ID',
    title VARCHAR(100) NOT NULL COMMENT '新闻标题',
    category_id BIGINT NOT NULL COMMENT '分类ID',
    content TEXT NOT NULL COMMENT '新闻内容（MD格式）',
    cover_img VARCHAR(255) COMMENT '封面图片',
    view_count INT DEFAULT 0 COMMENT '浏览量',
    audit_status TINYINT DEFAULT 1 COMMENT '审核状态 0-待审核 1-已通过 2-已驳回',
    create_by BIGINT COMMENT '创建人（管理员ID）',
    delete_flag TINYINT DEFAULT 0 COMMENT '软删除 0-未删 1-已删',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    INDEX idx_category_id (category_id),
    INDEX idx_audit_status (audit_status)
) COMMENT = '助农新闻表';
```

##### 3. 商家端核心模块
```sql
-- 商家信息表
CREATE TABLE merchant_info (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '商家ID',
    phone VARCHAR(11) NOT NULL COMMENT '手机号（登录账号）',
    merchant_name VARCHAR(50) NOT NULL COMMENT '农户/合作社名称',
    contact_person VARCHAR(20) NOT NULL COMMENT '联系人',
    contact_phone VARCHAR(11) NOT NULL COMMENT '联系电话',
    password VARCHAR(100) COMMENT '密码（可选）',
    audit_status TINYINT DEFAULT 0 COMMENT '审核状态 0-待审核 1-已通过 2-已驳回',
    reject_reason VARCHAR(200) COMMENT '驳回原因',
    status TINYINT DEFAULT 0 COMMENT '店铺状态 0-未开业 1-正常营业 2-禁用',
    login_token VARCHAR(100) COMMENT '登录态token',
    token_expire_time DATETIME COMMENT 'token过期时间',
    delete_flag TINYINT DEFAULT 0 COMMENT '软删除 0-未删 1-已删',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    UNIQUE KEY uk_phone (phone),
    INDEX idx_audit_status (audit_status),
    INDEX idx_status (status)
) COMMENT = '商家信息表';

-- 店铺信息表
CREATE TABLE shop_info (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '店铺ID',
    merchant_id BIGINT NOT NULL COMMENT '商家ID',
    shop_name VARCHAR(50) NOT NULL COMMENT '店铺名称',
    shop_intro VARCHAR(500) COMMENT '店铺简介',
    qualification_img VARCHAR(500) COMMENT '资质图片URL（逗号分隔）',
    delete_flag TINYINT DEFAULT 0 COMMENT '软删除 0-未删 1-已删',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    UNIQUE KEY uk_merchant_id (merchant_id)
) COMMENT = '店铺信息表';

-- 商家收款账户表
CREATE TABLE merchant_account (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '账户ID',
    merchant_id BIGINT NOT NULL COMMENT '商家ID',
    account_type TINYINT NOT NULL COMMENT '账户类型 1-支付宝 2-微信 3-银行卡',
    account_no VARCHAR(50) NOT NULL COMMENT '账户号（支付宝/微信账号/银行卡号）',
    account_name VARCHAR(50) NOT NULL COMMENT '账户名（真实姓名）',
    verify_status TINYINT DEFAULT 0 COMMENT '验证状态 0-未验证 1-已验证（1分钱验证）',
    audit_status TINYINT DEFAULT 0 COMMENT '修改审核状态 0-待审核 1-已通过 2-已驳回',
    delete_flag TINYINT DEFAULT 0 COMMENT '软删除 0-未删 1-已删',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    UNIQUE KEY uk_merchant_account (merchant_id, account_type),
    INDEX idx_verify_status (verify_status)
) COMMENT = '商家收款账户表';

-- 商品品类表
CREATE TABLE product_category (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '品类ID',
    category_name VARCHAR(30) NOT NULL COMMENT '品类名称（生鲜/干货/粮油等）',
    parent_id BIGINT DEFAULT 0 COMMENT '父品类ID（一级品类为0）',
    category_level TINYINT NOT NULL COMMENT '品类层级（1/2/3）',
    delete_flag TINYINT DEFAULT 0 COMMENT '软删除 0-未删 1-已删',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    INDEX idx_parent_id (parent_id)
) COMMENT = '商品品类表';

-- 商品信息表
CREATE TABLE product_info (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '商品ID',
    product_name VARCHAR(100) NOT NULL COMMENT '商品名称',
    merchant_id BIGINT NOT NULL COMMENT '商家ID',
    category_id BIGINT NOT NULL COMMENT '品类ID',
    price DECIMAL(10,2) NOT NULL COMMENT '商品价格',
    stock INT NOT NULL COMMENT '库存数量（Redis缓存核心字段）',
    stock_warning INT DEFAULT 10 COMMENT '库存预警值',
    product_img VARCHAR(500) COMMENT '商品图片URL（逗号分隔，多图轮播）',
    product_desc TEXT COMMENT '商品详细介绍',
    origin_place VARCHAR(50) COMMENT '产地（四川市县乡镇）',
    status TINYINT DEFAULT 0 COMMENT '状态 0-待审核 1-已上架 2-已下架 3-已驳回',
    reject_reason VARCHAR(200) COMMENT '驳回原因',
    is_unsalable TINYINT DEFAULT 0 COMMENT '是否滞销专区 0-否 1-是',
    sales_volume INT DEFAULT 0 COMMENT '销量（排序依据）',
    score DECIMAL(2,1) DEFAULT 5.0 COMMENT '商品评分（评价汇总）',
    delete_flag TINYINT DEFAULT 0 COMMENT '软删除 0-未删 1-已删',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    INDEX idx_merchant_id (merchant_id),
    INDEX idx_category_id (category_id),
    INDEX idx_status (status),
    INDEX idx_is_unsalable (is_unsalable),
    INDEX idx_sales_volume (sales_volume),
    INDEX idx_score (score)
) COMMENT = '商品信息表（适配分表：按merchant_id分表）';

-- 商品溯源信息表
CREATE TABLE product_trace (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '溯源ID',
    product_id BIGINT NOT NULL COMMENT '商品ID',
    planting_cycle VARCHAR(50) COMMENT '种植周期',
    origin_place_detail VARCHAR(100) COMMENT '详细产地',
    fertilizer_type VARCHAR(50) COMMENT '施肥类型',
    storage_method VARCHAR(50) COMMENT '保存方式',
    transport_method VARCHAR(50) COMMENT '运输方式',
    qr_code_url VARCHAR(255) COMMENT '溯源二维码URL',
    delete_flag TINYINT DEFAULT 0 COMMENT '软删除 0-未删 1-已删',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    UNIQUE KEY uk_product_id (product_id)
) COMMENT = '商品溯源信息表（可对接区块链存储）';

-- 对账明细表
CREATE TABLE reconciliation_detail (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '对账ID',
    merchant_id BIGINT NOT NULL COMMENT '商家ID',
    order_no VARCHAR(32) COMMENT '订单编号',
    order_amount DECIMAL(10,2) NOT NULL COMMENT '订单金额',
    actual_income DECIMAL(10,2) NOT NULL COMMENT '商家实际营收',
    service_fee DECIMAL(10,2) DEFAULT 0 COMMENT '平台服务费',
    payment_time DATETIME COMMENT '用户支付时间',
    transfer_status TINYINT DEFAULT 0 COMMENT '打款状态 0-待打款 1-打款成功 2-打款失败',
    transfer_time DATETIME COMMENT '打款时间',
    transfer_no VARCHAR(64) COMMENT '打款流水号',
    retry_count TINYINT DEFAULT 0 COMMENT '重试次数（最多3次）',
    delete_flag TINYINT DEFAULT 0 COMMENT '软删除 0-未删 1-已删',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    INDEX idx_merchant_id (merchant_id),
    INDEX idx_order_no (order_no),
    INDEX idx_transfer_status (transfer_status)
) COMMENT = '商家对账明细表（打款台账核心）';

-- 补贴明细表
CREATE TABLE subsidy_detail (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '补贴ID',
    merchant_id BIGINT NOT NULL COMMENT '商家ID',
    order_no VARCHAR(32) COMMENT '订单编号',
    subsidy_type VARCHAR(30) NOT NULL COMMENT '补贴类型（物流补贴）',
    subsidy_amount DECIMAL(10,2) NOT NULL COMMENT '补贴金额',
    audit_status TINYINT DEFAULT 0 COMMENT '审核状态 0-待审核 1-已通过 2-已驳回',
    grant_status TINYINT DEFAULT 0 COMMENT '发放状态 0-未发放 1-已发放 2-发放失败',
    grant_time DATETIME COMMENT '发放时间',
    reject_reason VARCHAR(200) COMMENT '驳回原因',
    delete_flag TINYINT DEFAULT 0 COMMENT '软删除 0-未删 1-已删',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    INDEX idx_merchant_id (merchant_id),
    INDEX idx_order_no (order_no),
    INDEX idx_audit_status (audit_status),
    INDEX idx_grant_status (grant_status)
) COMMENT = '补贴明细表';

-- 审核记录表（通用：商家/商品/滞销专区/补贴）
CREATE TABLE audit_record (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '审核记录ID',
    business_type VARCHAR(30) NOT NULL COMMENT '业务类型（merchant/ product/ unsalable/ subsidy）',
    business_id BIGINT NOT NULL COMMENT '业务ID（商家ID/商品ID等）',
    audit_user_id BIGINT COMMENT '审核人ID（管理员）',
    audit_status TINYINT NOT NULL COMMENT '审核状态 1-通过 2-驳回',
    audit_reason VARCHAR(200) COMMENT '审核意见/驳回原因',
    delete_flag TINYINT DEFAULT 0 COMMENT '软删除 0-未删 1-已删',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '审核时间',
    INDEX idx_business_type_id (business_type, business_id),
    INDEX idx_audit_user_id (audit_user_id)
) COMMENT = '通用审核记录表';
```

#### Redis缓存设计（适配性能优化）
结合你分阶段优化的需求，Redis主要缓存以下高频访问数据：
```
# 1. 用户登录态（7天有效期）
key: user:token:{token}
value: {user_id: 123, phone: "13800138000", expire_time: "2026-02-13 12:00:00"}
类型: Hash

# 2. 商品库存（实时同步，避免超卖）
key: product:stock:{product_id}
value: 100
类型: String

# 3. 订单支付倒计时（15分钟过期）
key: order:pay:timeout:{order_no}
value: {order_id: 456, user_id: 123, deadline: "2026-02-06 14:15:00"}
类型: Hash
过期时间: 15分钟

# 4. 热销商品排行（首页展示）
key: product:hot:rank
value: [product_id1, product_id2, ...]
类型: ZSet（score为销量）
过期时间: 1小时（定时更新）
```

### 三、总结
1. **核心表设计**：覆盖用户、商家、管理员三大端的全业务链路，核心表包括`user_info`（用户）、`merchant_info`（商家）、`product_info`（商品）、`order_main`（订单）、`after_sale`（售后）、`reconciliation_detail`（对账）等，满足“商品交易-溯源-售后-对账-补贴”全流程需求；
2. **扩展性适配**：
   - 主键用`bigint`支持分布式雪花算法，`order_main`/`product_info`预留分表字段（按时间/商家ID），适配中期ShardingSphere分库分表；
   - `product_trace`独立设计，可无缝对接区块链溯源（仅需扩展存储字段）；
   - 所有表添加`ext_json`预留字段（可根据实际需求补充），支持后期功能扩展；
3. **性能优化**：关键查询字段（订单状态、商家ID、商品ID）添加索引，Redis缓存登录态、库存、订单倒计时等高频数据，适配农村用户移动端轻量化访问需求。

你可根据实际开发进度，先实现核心表（用户、商品、订单、支付），再逐步扩展售后、补贴、审核等表，分阶段落地优化需求。